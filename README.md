# DapperRepo
Special Thanks to armanx

Simple dapper repo with async implementation aswell no interface base to build on all work to create the table for Runner

## creating new entities
please note the primary key attribute found in DapperRepo.PrimaryKeyAttribute.cs

```
    [SqlTableName("Test_Table")]         // can be used to get around pluralization and also unconventional table names  
    public class TestTable
    {
        [PrimaryKey] // Required for repo to work effectively
        public Guid Id { get; set; }
// if a field is auto generated by the db you can set it to be nullable i.e int? 
// if value is null unless told repo will not try to insert null fields but update will this can be overriden using ignoreNullProperties on the update method 

        public string Name { get; set; }
        public int SomeNumber { get; set; }
    }
```


## Usages


Search
```
Repo.Search<TableModel>("Name", "%cha%"); 

Repo.Search<TableModel>(nameof(TableModel.Name), "%cha%");    // recommended 
```

Query single
```
Repo.QuerySingle<TableModel>(
                "select * from TableModel where SomeNumber = 33");
```


Query Multiple
```
Repo.QueryMany<TableModel>(
                "select * from TableModel where SomeNumber = 33");
```

Get By Id
```
Repo.GetById(new TableWithGuid {Id =  Guid.Parse("....")});
Repo.GetById(new TableWithInt {Id =  325});
```

Get All
```
Repo.GetAll<TableModel>().ToArray();
```

Delete
```
var item =Repo.GetById(new TableModel {Id =  325});
Repo.Delete(item);
```


Add
```
 var testTableItem = new TableModel() {Name = "Michael", SomeNumber = 44};
 var resultBack = Sut.Add(testTableItem);
```

Update
```
 update command is built from the primary get so strictly speaking if you wish to update all the values on a row and know its primary key a get is not required

 var item = Repo.GetById(new TableModel {Id =  325});
 item.Name = "mike"
 item.Email = null
 Sut.Update(testTableItem); // will update properites and also null properties so db will set email to null

 // Example 2
 var item = Repo.GetById(new TableModel {Id =  325});
 item.Name = "mike"
 item.Email = null
 
 Sut.Update(testTableItem, true);   // will ignore null properties and only update name in db
```


## Getting Tests working
Connection.cs contains connection config these are not unit tests they do require a db and will spin one up on fly but for a repo seems better than mocking
```
   public static string MasterConnectionString = "Server=localhost;Database=master;Trusted_Connection=True";
```

also please note there are separate getall and insert methods that are raw in  DataBaseScriptRunnerAndBuilder.cs as we don't use the implemenation we are testing for setups or verifies.



Located in CreateDbWithTestTable.Sql you will find the create database scripts

